<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Kru Pai Classroom ‚Ä¢ Excretory System Quest (Stage Select)</title>
<style>
:root{
  --bg:#ffffff;
  --ink:#111827;
  --card:#ffffff;
  --brand:#F59E0B;     /* yellow */
  --accent:#FBBF24;    /* amber */
  --accent2:#16A34A;   /* green */
  --muted:#6B7280;
  --ok:#16A34A;
  --bad:#DC2626;
  --soft:#FFFBEB;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
.container{max-width:980px;margin:0 auto;padding:16px}
.header-top{
  background:linear-gradient(90deg,var(--brand),#60A5FA);
  color:#fff;padding:14px 16px;border-bottom:4px solid #dbeafe;
  display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
}
.brand-left{font-weight:900;letter-spacing:.4px;font-size:20px}
.pills{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.pill{
  display:inline-flex;gap:8px;align-items:center;
  padding:8px 12px;border-radius:999px;
  background:rgba(255,255,255,.18);
  border:1px solid rgba(255,255,255,.25);
  font-weight:800;color:#fff;
  backdrop-filter: blur(6px);
}
.pill button{
  border:none;border-radius:999px;
  padding:6px 10px;font-weight:900;cursor:pointer;
  background:rgba(255,255,255,.92);color:#111827;
}
.pill button.active{background:var(--accent);color:#fff}
.mainhead{
  margin:16px 0 10px 0;
  display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap
}
.h1{font-size:22px;font-weight:1000;color:var(--accent)}
.sub{color:var(--muted);font-weight:700;margin-top:4px}
.badge{
  display:none;
  padding:8px 12px;border-radius:999px;
  background:#eff6ff;border:2px solid #bfdbfe;
  font-weight:900;color:#1d4ed8;
  gap:8px;align-items:center;
}
.card{
  background:var(--card);
  border:2px solid #dbeafe;
  border-radius:16px;
  padding:18px;
  box-shadow:0 10px 22px rgba(37,99,235,.08);
}
.row{display:grid;gap:14px}
@media (min-width:900px){
  .row{grid-template-columns: 1.1fr .9fr; align-items:start;}
}
.input{
  width:100%;
  padding:16px;
  font-size:18px;
  border-radius:14px;
  border:2px solid #bfdbfe;
  text-align:center;
  font-weight:900;
  outline:none;
}
.input:focus{border-color:var(--brand); box-shadow:0 0 0 4px rgba(37,99,235,.12)}
.note{color:var(--muted);font-size:14px;text-align:center}
.btn{
  padding:12px 18px;border:none;border-radius:999px;
  font-weight:1000;font-size:16px;cursor:pointer;
}
.btn.primary{background:var(--brand);color:#fff}
.btn.accent{background:var(--accent);color:#fff}
.btn.secondary{background:#e2e8f0;color:#111827}
.btn.ghost{background:#fff;border:2px solid #e5e7eb;color:#111827}
.btn:disabled{opacity:.55;cursor:not-allowed}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.stage-grid{display:grid;gap:12px}
@media (min-width:700px){ .stage-grid{grid-template-columns:repeat(3,1fr);} }
.stage{
  border:2px solid #e5e7eb;border-radius:16px;padding:14px;background:var(--soft);
}
.stage h3{margin:0 0 6px 0;font-size:18px;font-weight:1000}
.stage p{margin:0;color:var(--muted);font-weight:700;font-size:13px;line-height:1.35}
.stage .tag{display:inline-flex;margin-top:10px;padding:6px 10px;border-radius:999px;font-weight:1000;font-size:12px}
.tag.ready{background:#ecfdf5;color:#065f46;border:1px solid #bbf7d0}
.tag.soon{background:#fff7ed;color:#9a3412;border:1px solid #fed7aa}
.progress{font-weight:1000;color:var(--brand);font-size:18px}
.qbox{
  border:2px solid #e5e7eb;border-radius:16px;padding:16px;background:#fff;
}
.question{
  font-weight:1000;font-size:20px;line-height:1.45;margin:0 0 12px 0;
}
.choices{display:grid;gap:10px}
.choice{
  border:2px solid #e5e7eb;border-radius:14px;
  padding:14px 16px;font-weight:900;font-size:17px;
  background:#f8fafc;cursor:pointer;text-align:left;
}
.choice:hover{border-color:var(--brand)}
.choice.selected{border-color:var(--accent);background:#fff7ed}
.choice.correct{border-color:var(--ok);background:#ecfdf5}
.choice.wrong{border-color:var(--bad);background:#fef2f2}
.choice.locked{cursor:not-allowed;opacity:.8}
.choice:disabled{cursor:not-allowed;opacity:.82}
.jumper{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(44px,1fr));
  gap:8px;margin-top:12px
}
.dot{
  padding:10px;border-radius:14px;border:2px solid #e5e7eb;background:#fff;
  font-weight:900;cursor:pointer;position:relative;
}
.dot.current{border-color:var(--accent)}
.dot.done{background:#fff7ed}
.dot.correct{background:#ecfdf5;border-color:var(--ok)}
.dot.wrong{background:#fef2f2;border-color:var(--bad)}
.dot.correct::after{
  content:"‚úìüòÅ";
  position:absolute;right:-10px;top:-10px;font-size:13px;
}
.dot.wrong::after{
  content:"‚úóüòÖ";
  position:absolute;right:-10px;top:-10px;font-size:13px;
}
.big-emoji{
  position:fixed;top:42%;left:50%;
  transform:translate(-50%,-50%) scale(.25);
  font-size:5.2rem;z-index:9999;pointer-events:none;
  animation:bigPop .9s ease-out forwards;
  filter:drop-shadow(0 10px 16px rgba(0,0,0,.18));
}
@keyframes bigPop{
  0%{opacity:0;transform:translate(-50%,-50%) scale(.25)}
  40%{opacity:1;transform:translate(-50%,-50%) scale(1.25)}
  100%{opacity:0;transform:translate(-50%,-60%) scale(1)}
}
.result h2{margin:6px 0 0 0;font-size:26px;font-weight:1000;color:var(--brand)}
.praise{font-size:20px;font-weight:1000;margin:8px 0 2px 0}
.history{
  margin-top:14px;border:2px dashed #cbd5e1;border-radius:16px;
  padding:14px;background:#f8fafc;
}
.hist-table{width:100%;border-collapse:collapse;font-size:14px}
.hist-table th,.hist-table td{padding:8px;border-bottom:1px solid #e5e7eb;text-align:left}
.hist-table th{color:#374151;font-weight:1000}
.footer{margin:18px 0 6px 0;color:var(--muted);font-size:12px;text-align:center}
.small{font-size:12px;color:var(--muted);font-weight:700}
</style>
</head>
<body>

<div class="header-top">
  <div class="brand-left">Kru Pai Classroom</div>
  <div class="pills">
    <div class="pill" title="Language">
      üåê
      <button id="langTH" onclick="setLang('th')">TH</button>
      <button id="langEN" onclick="setLang('en')">EN</button>
    </div>
    <div class="pill badge" id="playerBadge">üë§ <span id="badgeLabel">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</span>: <span id="playerBadgeName"></span></div>
  </div>
</div>

<div class="container">
  <div class="mainhead">
    <div>
      <div class="h1" id="title">üß† ‡πÄ‡∏Å‡∏°‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢ (3 ‡∏î‡πà‡∏≤‡∏ô)</div>
      <div class="sub" id="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô ‚Ä¢ ‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚Ä¢ ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</div>
    </div>
    <div class="progress" id="progressText"></div>
  </div>

  <!-- LOGIN -->
  <div id="screenLogin" class="card">
    <div class="row">
      <div>
        <h2 style="margin:0 0 6px 0;color:var(--brand);font-weight:1000" id="loginTitle">üéí ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</h2>
        <div class="note" id="loginHint">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
        <input id="playerNameInput" class="input" type="text" maxlength="24" autocomplete="off" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≠‡∏á‡∏û‡∏µ / Emma / Aladin" />
        <button class="btn primary" style="width:100%;font-size:18px" onclick="goStageSelect()">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</button>
        <div class="note" id="lastPlayHint" style="display:none;margin-top:8px"></div>
      </div>
      <div class="card" style="border-color:#fed7aa;background:#fff7ed">
        <div style="font-weight:1000;color:#9a3412;margin-bottom:8px" id="howTitle">‚ú® ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô</div>
        <div class="small" id="howText">
          1) ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ ‚Üí 2) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô ‚Üí 3) ‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠<br/>
          ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å = üòÅüéâ ‚Ä¢ ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î = üòÖüí¶
        </div>
        <div style="margin-top:10px" class="small">
          <span style="font-weight:1000" id="tipLabel">‡∏ó‡∏¥‡∏õ:</span> <span id="tipText">‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡πâ‡∏ô</span>
        </div>
      </div>
    </div>
  </div>

  <!-- STAGE SELECT -->
  <div id="screenStage" class="card" style="display:none">
    <h2 style="margin:0 0 10px 0;color:var(--accent);font-weight:1000" id="stageTitle">üó∫Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏•‡πà‡∏ô</h2>
    <div class="stage-grid">
      <div class="stage">
        <h3 id="s1Title">üü° ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1 ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢</h3>
        <p id="s1Desc">‡πÑ‡∏ï ‚Ä¢ ‡πÄ‡∏ô‡∏ü‡∏£‡∏≠‡∏ô ‚Ä¢ ‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ ‚Ä¢ ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ô‡πâ‡∏≥/‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÅ‡∏£‡πà (30 ‡∏Ç‡πâ‡∏≠)</p>
        <div class="tag ready" id="s1Tag">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô</div>
        <div class="controls">
          <button class="btn accent" onclick="startStage(1)">‚ñ∂Ô∏è <span id="play1">‡πÄ‡∏•‡πà‡∏ô‡∏î‡πà‡∏≤‡∏ô 1</span></button>
        </div>
      </div>

      <div class="stage" style="display:none">
        <h3 id="s2Title">üß™ ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2 ‚Ä¢ ‡πÄ‡∏≠‡∏ô‡πÑ‡∏ã‡∏°‡πå & pH</h3>
        <p id="s2Desc">‡πÄ‡∏≠‡∏ô‡πÑ‡∏ã‡∏°‡πå‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‚Ä¢ pH ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‚Ä¢ ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≠‡∏¢</p>
        <div class="tag soon" id="s2Tag">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</div>
        <div class="controls">
          <button class="btn secondary" disabled>‚è≥ <span id="play2">‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</span></button>
        </div>
      </div>

      <div class="stage" style="display:none">
        <h3 id="s3Title">ü´Ä ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3 ‚Ä¢ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
        <p id="s3Desc">‡∏ï‡πà‡∏≠‡∏°‡∏ô‡πâ‡∏≥‡∏•‡∏≤‡∏¢ ‚Ä¢ ‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞ ‚Ä¢ ‡∏•‡∏≥‡πÑ‡∏™‡πâ‡πÄ‡∏•‡πá‡∏Å/‡πÉ‡∏´‡∏ç‡πà (‡∏•‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô)</p>
        <div class="tag soon" id="s3Tag">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</div>
        <div class="controls">
          <button class="btn secondary" disabled>‚è≥ <span id="play3">‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</span></button>
        </div>
      </div>
    </div>

    <div class="controls" style="margin-top:14px">
      <button class="btn ghost" onclick="backToLogin()">‚Ü©Ô∏è <span id="backLogin">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span></button>
    </div>

    <div class="history" id="stageHistoryBox" style="display:none">
      <div style="font-weight:1000;margin-bottom:8px" id="histTitle">üìí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏î‡πà‡∏≤‡∏ô)</div>
      <div style="overflow:auto">
        <table class="hist-table" id="stageHistoryTable"></table>
      </div>
      <div class="controls" style="margin-top:12px">
        <button class="btn secondary" onclick="clearAllMyHistory()">üßπ <span id="clearHist">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span></button>
      </div>
    </div>
  </div>

  <!-- GAME -->
  <div id="screenGame" class="card" style="display:none">
    <div class="qbox">
      <div class="question" id="question"></div>
      <div class="choices" id="choices"></div>
      <div class="controls">
        <button class="btn secondary" onclick="prevQ()">‚Üê <span id="btnPrev">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</span></button>
        <button class="btn primary" onclick="nextQ()"><span id="btnNext">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span> ‚Üí</button>
        <button class="btn accent" onclick="finish()">üèÅ <span id="btnFinish">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span></button>
        <button class="btn ghost" onclick="exitToStages()">üó∫Ô∏è <span id="btnExit">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô</span></button>
      </div>
      <div class="jumper" id="jumper"></div>
      <div class="small" id="lockNote" style="margin-top:10px">* ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏•‡πá‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏°‡∏±‡πà‡∏ß (‡πÅ‡∏ô‡∏ß Kru Pai)</div>
    </div>
  </div>

  <!-- RESULT -->
  <div id="screenResult" class="card result" style="display:none">
    <div id="playerShow" style="font-size:22px;font-weight:1000;color:var(--accent);margin:0 0 6px 0"></div>
    <div id="praiseText" class="praise"></div>
    <h2 id="scoreBig"></h2>
    <p id="summary" style="margin:6px 0 0 0;color:var(--muted);font-weight:900"></p>

    <div class="history" id="historyBox" style="display:none">
      <div style="font-weight:1000;margin-bottom:8px" id="hist2Title">üìí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ)</div>
      <div style="overflow:auto">
        <table class="hist-table" id="historyTable"></table>
      </div>
      <div class="controls" style="margin-top:12px">
        <button class="btn secondary" onclick="clearMyStageHistory()">üßπ <span id="clearStage">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</span></button>
      </div>
    </div>

    <div class="controls" style="margin-top:14px">
      <button class="btn primary" onclick="replayStage()">üîÅ <span id="replay">‡πÄ‡∏•‡πà‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span></button>
      <button class="btn ghost" onclick="exitToStages()">üó∫Ô∏è <span id="backStages">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô</span></button>
    </div>
  </div>

  <div class="footer">¬© Kru Pai Classroom ‚Ä¢ Excretory System Quest ‚Ä¢ Stage Select ‚Ä¢ TH/EN</div>
</div>

<script>
/* =======================
   Language UI
======================= */
let LANG = localStorage.getItem("kru_lang_digestive") || "th";
const UI = {
  th: {
    title: "üß† ‡πÄ‡∏Å‡∏°‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢ (3 ‡∏î‡πà‡∏≤‡∏ô)",
    subtitle: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô ‚Ä¢ ‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚Ä¢ ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô",
    badgeLabel:"‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô",
    loginTitle:"üéí ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°",
    loginHint:"‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢",
    howTitle:"‚ú® ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô",
    howText:"1) ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ ‚Üí 2) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô ‚Üí 3) ‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠<br/>‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å = üòÅüéâ ‚Ä¢ ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î = üòÖüí¶",
    tipLabel:"‡∏ó‡∏¥‡∏õ:",
    tipText:"‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡πâ‡∏ô",
    stageTitle:"üó∫Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏•‡πà‡∏ô",
    s1Title:"üü° ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 1 ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢",
    s1Desc:"‡πÑ‡∏ï ‚Ä¢ ‡πÄ‡∏ô‡∏ü‡∏£‡∏≠‡∏ô ‚Ä¢ ‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ ‚Ä¢ ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ô‡πâ‡∏≥/‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÅ‡∏£‡πà (30 ‡∏Ç‡πâ‡∏≠)",
    s2Title:"üß™ ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 2 ‚Ä¢ ‡πÄ‡∏≠‡∏ô‡πÑ‡∏ã‡∏°‡πå & pH",
    s2Desc:"‡πÄ‡∏≠‡∏ô‡πÑ‡∏ã‡∏°‡πå‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‚Ä¢ pH ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‚Ä¢ ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡πâ‡∏≥‡∏¢‡πà‡∏≠‡∏¢",
    s3Title:"ü´Ä ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà 3 ‚Ä¢ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
    s3Desc:"‡∏ï‡πà‡∏≠‡∏°‡∏ô‡πâ‡∏≥‡∏•‡∏≤‡∏¢ ‚Ä¢ ‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞ ‚Ä¢ ‡∏•‡∏≥‡πÑ‡∏™‡πâ‡πÄ‡∏•‡πá‡∏Å/‡πÉ‡∏´‡∏ç‡πà (‡∏•‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô)",
    ready:"‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô",
    soon:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°",
    play1:"‡πÄ‡∏•‡πà‡∏ô‡∏î‡πà‡∏≤‡∏ô 1",
    play2:"‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ",
    play3:"‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ",
    backLogin:"‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å",
    histTitle:"üìí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏î‡πà‡∏≤‡∏ô)",
    clearHist:"‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
    btnPrev:"‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö",
    btnNext:"‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
    btnFinish:"‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
    btnExit:"‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô",
    lockNote:"* ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏•‡πá‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏°‡∏±‡πà‡∏ß (‡πÅ‡∏ô‡∏ß Kru Pai)",
    hist2Title:"üìí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô (‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ)",
    clearStage:"‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ",
    replay:"‡πÄ‡∏•‡πà‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
    backStages:"‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô",
    qLabel:(i,t)=>`‡∏Ç‡πâ‡∏≠ ${i}/${t}`,
    score:(s,t)=>`‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ${s}/${t} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`,
    percent:(p)=>`‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô ${p}%`,
    playerShow:(name,stage)=>`üèÖ ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô : ${name} ‚Ä¢ ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${stage}`,
    stageName:(n)=> n===1? "‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£" : (n===2? "‡πÄ‡∏≠‡∏ô‡πÑ‡∏ã‡∏°‡πå & pH" : "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞"),
  },
  en: {
    title: "üß† Excretory System Quest (Single Stage)",
    subtitle: "Choose a stage ‚Ä¢ Instant feedback ‚Ä¢ Play history",
    badgeLabel:"Player",
    loginTitle:"üéí Enter your name",
    loginHint:"Type a nickname and press Start.",
    howTitle:"‚ú® How to play",
    howText:"1) Enter name ‚Üí 2) Choose stage ‚Üí 3) Answer one by one<br/>Correct = üòÅüéâ ‚Ä¢ Wrong = üòÖüí¶",
    tipLabel:"Tip:",
    tipText:"Replay anytime ‚Äî your scores are saved under your name.",
    stageTitle:"üó∫Ô∏è Choose a stage",
    s1Title:"ü•™ Stage 1 ‚Ä¢ Digestion results",
    s1Desc:"Eat ‚Üí digest ‚Üí what you get ‚Üí where it‚Äôs absorbed (30 Qs)",
    s2Title:"üß™ Stage 2 ‚Ä¢ Enzymes & pH",
    s2Desc:"Digestive enzymes ‚Ä¢ optimal pH ‚Ä¢ where juices are made",
    s3Title:"ü´Ä Stage 3 ‚Ä¢ Organ structure",
    s3Desc:"Salivary glands ‚Ä¢ stomach ‚Ä¢ small/large intestine (deeper)",
    ready:"Ready",
    soon:"Coming soon",
    play1:"Play Stage 1",
    play2:"Coming soon",
    play3:"Coming soon",
    backLogin:"Back to home",
    histTitle:"üìí Play history (by stage)",
    clearHist:"Clear all history for this name",
    btnPrev:"Back",
    btnNext:"Next",
    btnFinish:"Finish",
    btnExit:"Back to stages",
    lockNote:"* Wrong answers lock the question to prevent random tapping.",
    hist2Title:"üìí Play history (this stage)",
    clearStage:"Clear this stage history",
    replay:"Replay this stage",
    backStages:"Back to stages",
    qLabel:(i,t)=>`Q ${i}/${t}`,
    score:(s,t)=>`You scored ${s}/${t}`,
    percent:(p)=>`${p}%`,
    playerShow:(name,stage)=>`üèÖ Player: ${name} ‚Ä¢ Stage ${stage}`,
    stageName:(n)=> n===1? "Digestion results" : (n===2? "Enzymes & pH" : "Organ structure"),
  }
};
function setLang(l){
  LANG = l;
  localStorage.setItem("kru_lang_digestive", LANG);
  document.getElementById("langTH").classList.toggle("active", LANG==="th");
  document.getElementById("langEN").classList.toggle("active", LANG==="en");
  applyUI();
  renderLastPlayHint();
  if(state.screen==="game") render();
  if(state.screen==="stage") renderStageHistory();
}
function applyUI(){
  const t = UI[LANG];
  document.getElementById("title").textContent = t.title;
  document.getElementById("subtitle").textContent = t.subtitle;
  document.getElementById("badgeLabel").textContent = t.badgeLabel;

  document.getElementById("loginTitle").textContent = t.loginTitle;
  document.getElementById("loginHint").textContent = t.loginHint;
  document.getElementById("howTitle").textContent = t.howTitle;
  document.getElementById("howText").innerHTML = t.howText;
  document.getElementById("tipLabel").textContent = t.tipLabel;
  document.getElementById("tipText").textContent = t.tipText;

  document.getElementById("stageTitle").textContent = t.stageTitle;
  document.getElementById("s1Title").textContent = t.s1Title;
  document.getElementById("s1Desc").textContent = t.s1Desc;
  document.getElementById("s2Title").textContent = t.s2Title;
  document.getElementById("s2Desc").textContent = t.s2Desc;
  document.getElementById("s3Title").textContent = t.s3Title;
  document.getElementById("s3Desc").textContent = t.s3Desc;
  document.getElementById("s1Tag").textContent = t.ready;
  document.getElementById("s2Tag").textContent = t.soon;
  document.getElementById("s3Tag").textContent = t.soon;
  document.getElementById("play1").textContent = t.play1;
  document.getElementById("play2").textContent = t.play2;
  document.getElementById("play3").textContent = t.play3;
  document.getElementById("backLogin").textContent = t.backLogin;
  document.getElementById("histTitle").textContent = t.histTitle;
  document.getElementById("clearHist").textContent = t.clearHist;

  document.getElementById("btnPrev").textContent = t.btnPrev;
  document.getElementById("btnNext").textContent = t.btnNext;
  document.getElementById("btnFinish").textContent = t.btnFinish;
  document.getElementById("btnExit").textContent = t.btnExit;
  document.getElementById("lockNote").textContent = t.lockNote;

  document.getElementById("hist2Title").textContent = t.hist2Title;
  document.getElementById("clearStage").textContent = t.clearStage;
  document.getElementById("replay").textContent = t.replay;
  document.getElementById("backStages").textContent = t.backStages;
}

/* =======================
   Tiny sounds (WebAudio)
======================= */
let audioCtx = null;
function beep(freq=740, dur=0.06, gain=0.05){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type="sine";
    o.frequency.value=freq;
    g.gain.value=gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + dur);
  }catch(e){}
}
function sClick(){beep(520,0.05,0.05)}
function sOk(){beep(880,0.08,0.06)}
function sBad(){beep(220,0.09,0.06)}

/* =======================
   Data: Stage 1 (30)
======================= */
const STAGE_DATA = {
  1: [
    {q_th:"‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£",q_en:"What is the main function of the excretory system?",options_th:["‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥/‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÅ‡∏£‡πà", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏î‡∏á", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á"],options_en:["Digest food", "Remove wastes and maintain water/salt balance", "Make red blood cells", "Make sound"],a:1},
    {q_th:"‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£",q_en:"What is the main organ of the urinary system?",options_th:["‡∏õ‡∏≠‡∏î", "‡πÑ‡∏ï", "‡∏´‡∏±‡∏ß‡πÉ‡∏à", "‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£"],options_en:["Lungs", "Kidneys", "Heart", "Stomach"],a:1},
    {q_th:"‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÑ‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÉ‡∏î",q_en:"Blood enters the kidney through which vessel?",options_th:["‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏î‡∏á‡πÑ‡∏ï", "‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏î‡∏≥‡πÑ‡∏ï", "‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏î‡∏á‡∏õ‡∏≠‡∏î", "‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏î‡∏≥‡πÄ‡∏ß‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏ß‡∏≤"],options_en:["Renal artery", "Renal vein", "Pulmonary artery", "Vena cava"],a:0},
    {q_th:"‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÑ‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£",q_en:"What is the structural and functional unit of the kidney called?",options_th:["‡∏ô‡∏¥‡∏ß‡∏£‡∏≠‡∏ô", "‡πÄ‡∏ô‡∏ü‡∏£‡∏≠‡∏ô", "‡∏ñ‡∏∏‡∏á‡∏•‡∏°", "‡∏ß‡∏¥‡∏•‡∏•‡∏±‡∏™"],options_en:["Neuron", "Nephron", "Alveolus", "Villus"],a:1},
    {q_th:"‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏ü‡∏£‡∏≠‡∏ô",q_en:"Initial filtration occurs at which part of a nephron?",options_th:["‡∏ó‡πà‡∏≠‡∏£‡∏ß‡∏° (collecting duct)", "‡πÇ‡∏Å‡∏•‡πÄ‡∏°‡∏≠‡∏£‡∏π‡∏•‡∏±‡∏™‡πÉ‡∏ô‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÇ‡∏ö‡∏ß‡πå‡πÅ‡∏°‡∏ô", "‡∏ó‡πà‡∏≠‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", "‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞"],options_en:["Collecting duct", "Glomerulus in Bowman's capsule", "Urethra", "Urinary bladder"],a:1},
    {q_th:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏µ‡πà‡πÑ‡∏ï‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏î",q_en:"Which is an example of waste removed by kidneys?",options_th:["‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô", "‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢", "‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™ (‡∏õ‡∏Å‡∏ï‡∏¥)", "‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô"],options_en:["Oxygen", "Urea", "Glucose (normally)", "Vitamins"],a:1},
    {q_th:"‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏≥‡πÄ‡∏•‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ï‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏∞‡πÑ‡∏£",q_en:"Urine travels from kidneys to the bladder through the‚Ä¶",options_th:["‡∏ó‡πà‡∏≠‡πÑ‡∏ï", "‡∏ó‡πà‡∏≠‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", "‡∏´‡∏•‡∏≠‡∏î‡∏•‡∏°", "‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏î‡∏≥"],options_en:["Ureter", "Urethra", "Trachea", "Vein"],a:0},
    {q_th:"‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£",q_en:"Which organ stores urine before it is excreted?",options_th:["‡∏ó‡πà‡∏≠‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", "‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", "‡∏ó‡πà‡∏≠‡πÑ‡∏ï", "‡∏•‡∏≥‡πÑ‡∏™‡πâ‡πÉ‡∏´‡∏ç‡πà"],options_en:["Urethra", "Urinary bladder", "Ureter", "Large intestine"],a:1},
    {q_th:"‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏î",q_en:"Urine leaves the body through the‚Ä¶",options_th:["‡∏ó‡πà‡∏≠‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", "‡∏ó‡πà‡∏≠‡πÑ‡∏ï", "‡∏´‡∏•‡∏≠‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏î‡∏á"],options_en:["Urethra", "Ureter", "Esophagus", "Artery"],a:0},
    {q_th:"‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡πÉ‡∏ô‡πÄ‡∏ô‡∏ü‡∏£‡∏≠‡∏ô‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á",q_en:"Key steps of urine formation include‚Ä¶",options_th:["‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡πà‡∏á", "‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢ ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏ã‡∏∂‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢", "‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å", "‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏™‡∏á"],options_en:["Filtration, reabsorption, and secretion", "Digestion, absorption, and excretion", "Inhalation and exhalation", "Photosynthesis"],a:0},
    {q_th:"‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö (reabsorption) ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏≠‡∏∞‡πÑ‡∏£",q_en:"Reabsorption means‚Ä¶",options_th:["‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ñ‡∏π‡∏Å‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞", "‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏ñ‡∏π‡∏Å‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏î", "‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ñ‡∏π‡∏Å‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏≠‡∏î", "‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏±‡∏ß‡πÉ‡∏à"],options_en:["Wastes return to the stomach", "Useful substances return to the blood", "Blood returns to lungs", "Urine returns to heart"],a:1},
    {q_th:"‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",q_en:"Normally, filtered glucose is‚Ä¶",options_th:["‡∏ñ‡∏π‡∏Å‡∏Ç‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏î", "‡∏ñ‡∏π‡∏Å‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", "‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ", "‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞"],options_en:["All excreted", "Almost all reabsorbed", "Turned into urea immediately", "Stored in the bladder"],a:1},
    {q_th:"‡∏ñ‡πâ‡∏≤‡∏û‡∏ö‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™‡πÉ‡∏ô‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏°‡∏≤‡∏Å‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏Ñ‡πÉ‡∏î",q_en:"High glucose in urine may relate to‚Ä¶",options_th:["‡πÇ‡∏£‡∏Ñ‡∏´‡∏≠‡∏ö‡∏´‡∏∑‡∏î", "‡πÇ‡∏£‡∏Ñ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô", "‡πÇ‡∏£‡∏Ñ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏û‡∏£‡∏∏‡∏ô", "‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î"],options_en:["Asthma", "Diabetes", "Osteoporosis", "Flu"],a:1},
    {q_th:"‡πÑ‡∏ï‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÅ‡∏£‡πà‡∏Ç‡∏≠‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",q_en:"How do kidneys help maintain water and salt balance?",options_th:["‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡πâ‡∏≥‡∏î‡∏µ", "‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÅ‡∏£‡πà‡πÉ‡∏ô‡∏ó‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ï", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô", "‡∏¢‡πà‡∏≠‡∏¢‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô"],options_en:["Make bile", "Adjust reabsorption of water and salts in tubules", "Make oxygen", "Digest protein"],a:1},
    {q_th:"‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î‡∏ô‡πâ‡∏≥ ‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",q_en:"When the body is dehydrated, urine is usually‚Ä¶",options_th:["‡∏à‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏°‡∏≤‡∏Å", "‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≠‡∏¢", "‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏¢‡πÄ‡∏™‡∏°‡∏≠"],options_en:["Very dilute and large volume", "More concentrated and smaller volume", "Green", "Always none"],a:1},
    {q_th:"‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô ADH ‡∏°‡∏µ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢",q_en:"ADH mainly affects‚Ä¶",options_th:["‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢‡πÑ‡∏Ç‡∏°‡∏±‡∏ô", "‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡πÑ‡∏ï", "‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏≤‡∏ß", "‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏Å‡πä‡∏™"],options_en:["Fat digestion", "Water reabsorption in kidneys", "White blood cell production", "Gas exchange"],a:1},
    {q_th:"‡∏ñ‡πâ‡∏≤ ADH ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",q_en:"If ADH increases, urine will generally‚Ä¶",options_th:["‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏≤‡∏á‡∏•‡∏á", "‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô", "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏¢", "‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡πâ‡∏≥‡∏î‡∏µ"],options_en:["Increase and become dilute", "Decrease and become concentrated", "Not change", "Turn into bile"],a:1},
    {q_th:"‡∏™‡∏≤‡∏£‡πÉ‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏µ‡πà‡∏õ‡∏≠‡∏î‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏±‡∏ö‡∏≠‡∏≠‡∏Å",q_en:"Which waste is removed by the lungs?",options_th:["‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢", "‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡πÑ‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏ã‡∏î‡πå", "‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™", "‡πÅ‡∏õ‡πâ‡∏á"],options_en:["Urea", "Carbon dioxide", "Glucose", "Starch"],a:1},
    {q_th:"‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏î",q_en:"Skin excretes wastes mainly through‚Ä¶",options_th:["‡πÄ‡∏´‡∏á‡∏∑‡πà‡∏≠", "‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÉ‡∏à", "‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢", "‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏ã‡∏∂‡∏°"],options_en:["Sweating", "Breathing", "Digestion", "Absorption"],a:0},
    {q_th:"‡πÄ‡∏´‡∏á‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÉ‡∏î‡πÄ‡∏î‡πà‡∏ô",q_en:"Sweat mainly contains‚Ä¶",options_th:["‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÅ‡∏£‡πà‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô", "‡∏ô‡πâ‡∏≥‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏ô‡πÑ‡∏ã‡∏°‡πå", "‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å", "‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å"],options_en:["Water and some salts", "Bile and enzymes", "Very high glucose", "Lots of proteins"],a:0},
    {q_th:"‡∏ï‡∏±‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",q_en:"How is the liver related to wastes?",options_th:["‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏π‡πÇ‡∏Ñ‡∏™", "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏≠‡∏°‡πÇ‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô", "‡∏î‡∏π‡∏î‡∏ã‡∏∂‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"],options_en:["Turns urea into glucose", "Converts ammonia to urea", "Produces oxygen", "Absorbs all nutrients"],a:1},
    {q_th:"‡πÅ‡∏≠‡∏°‡πÇ‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡πÉ‡∏î",q_en:"Ammonia is‚Ä¶",options_th:["‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©", "‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡∏©‡∏ï‡πà‡∏≠‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢ ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ", "‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•", "‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏≠‡∏ô‡πÑ‡∏ã‡∏°‡πå‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£"],options_en:["Non-toxic", "Toxic and needs conversion", "A sugar", "A digestive enzyme"],a:1},
    {q_th:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",q_en:"Which is the correct urine pathway?",options_th:["‡πÑ‡∏ï ‚Üí ‡∏ó‡πà‡∏≠‡πÑ‡∏ï ‚Üí ‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ ‚Üí ‡∏ó‡πà‡∏≠‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", "‡πÑ‡∏ï ‚Üí ‡∏ó‡πà‡∏≠‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ ‚Üí ‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ ‚Üí ‡∏ó‡πà‡∏≠‡πÑ‡∏ï", "‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞ ‚Üí ‡πÑ‡∏ï ‚Üí ‡∏ó‡πà‡∏≠‡πÑ‡∏ï", "‡πÑ‡∏ï ‚Üí ‡∏•‡∏≥‡πÑ‡∏™‡πâ‡πÉ‡∏´‡∏ç‡πà ‚Üí ‡∏ó‡πà‡∏≠‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞"],options_en:["Kidney ‚Üí ureter ‚Üí bladder ‚Üí urethra", "Kidney ‚Üí urethra ‚Üí bladder ‚Üí ureter", "Bladder ‚Üí kidney ‚Üí ureter", "Kidney ‚Üí large intestine ‚Üí urethra"],a:0},
    {q_th:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞",q_en:"Which statement about the bladder is correct?",options_th:["‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î", "‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß", "‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏î‡∏ã‡∏∂‡∏°‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏Å‡πä‡∏™"],options_en:["Filters blood", "Temporarily stores urine", "Absorbs nutrients", "Exchanges gases"],a:1},
    {q_th:"‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏Å‡πÑ‡∏ï (dialysis) ‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£",q_en:"Dialysis helps patients with‚Ä¶",options_th:["‡πÑ‡∏ï‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á", "‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡πÇ‡∏ï", "‡∏•‡∏≥‡πÑ‡∏™‡πâ‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô", "‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡πá‡∏ß"],options_en:["Kidney failure", "Enlarged bladder", "Intestinal blockage", "Fast heartbeat"],a:0},
    {q_th:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÑ‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏î",q_en:"A kidney function related to blood is‚Ä¶",options_th:["‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Æ‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏ô‡∏ö‡∏≤‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡πá‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏Ç‡∏≤‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏î‡πÄ‡∏™‡∏°‡∏≠", "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏ï‡∏±‡∏ß‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"],options_en:["Produce some hormones and help regulate blood pressure", "Make all WBC", "Always make blood acidic", "Instantly clot blood"],a:0},
    {q_th:"‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏Å‡∏£‡∏î-‡πÄ‡∏ö‡∏™‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î ‡πÑ‡∏ï‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",q_en:"How do kidneys help acid‚Äìbase balance?",options_th:["‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö/‡∏î‡∏π‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏Æ‡πÇ‡∏î‡∏£‡πÄ‡∏à‡∏ô‡πÑ‡∏≠‡∏≠‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡πÑ‡∏ö‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡πÄ‡∏ô‡∏ï", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°", "‡∏¢‡πà‡∏≠‡∏¢‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡πâ‡∏≥‡∏•‡∏≤‡∏¢"],options_en:["Adjust excretion/reabsorption of H‚Å∫ and bicarbonate", "Make more oxygen", "Digest protein", "Make saliva"],a:0},
    {q_th:"‡∏ñ‡πâ‡∏≤‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏≤‡∏Å‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏°‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£",q_en:"If you drink a lot of water quickly, urine is usually‚Ä¶",options_th:["‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≠‡∏¢", "‡∏à‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô", "‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏™‡∏°‡∏≠", "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏¢"],options_en:["Concentrated and little", "More dilute and larger volume", "Always red", "None"],a:1},
    {q_th:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢ (excretion) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡∏ö‡∏≠‡∏≠‡∏Å (egestion)",q_en:"Which is excretion (not egestion)?",options_th:["‡∏Ç‡∏±‡∏ö‡∏≠‡∏∏‡∏à‡∏à‡∏≤‡∏£‡∏∞", "‡∏Ç‡∏±‡∏ö‡∏¢‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", "‡∏Ñ‡∏≤‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏•‡∏∑‡∏ô‡∏ú‡∏¥‡∏î", "‡∏≠‡∏≤‡πÄ‡∏à‡∏µ‡∏¢‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏°‡∏≤"],options_en:["Defecating feces", "Removing urea in urine", "Spitting out food", "Vomiting food"],a:1},
    {q_th:"‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÉ‡∏î",q_en:"Which best summarizes the excretory system?",options_th:["‡∏Å‡∏≥‡∏à‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢", "‡∏¢‡πà‡∏≠‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß"],options_en:["Removes wastes and helps maintain homeostasis", "Produces energy for the body", "Only digests food", "Only makes blood"],a:0}
  ],
  2: [],
  3: [],
};

/* =======================
   State & LocalStorage
======================= */
const state = {
  screen: "login", // login | stage | game | result
  playerName: "",
  stage: 1,
  idx: 0,
  picked: [],
  judged: [],
  orderMaps: []
};
function keyAll(){ return "kruPai_digestive_history_v1"; } // {name:{stage1:[],stage2:[],stage3:[]}}
function loadAllHistory(){
  try{ return JSON.parse(localStorage.getItem(keyAll()) || "{}"); }
  catch(e){ return {}; }
}
function saveAllHistory(obj){
  localStorage.setItem(keyAll(), JSON.stringify(obj));
}
function ensureNameRecord(all, name){
  if(!all[name]) all[name] = {stage1:[],stage2:[],stage3:[]};
  if(!all[name].stage1) all[name].stage1=[];
  if(!all[name].stage2) all[name].stage2=[];
  if(!all[name].stage3) all[name].stage3=[];
}
function getStageArr(all, name, stage){
  ensureNameRecord(all,name);
  return stage===1? all[name].stage1 : stage===2? all[name].stage2 : all[name].stage3;
}
function addAttempt(name, stage, score, total){
  const all = loadAllHistory();
  ensureNameRecord(all,name);
  const now = new Date();
  const stamp = now.toLocaleString("th-TH",{hour12:false});
  const arr = getStageArr(all,name,stage);
  arr.unshift({t:stamp, score, total});
  all[name][stage===1?"stage1":stage===2?"stage2":"stage3"] = arr.slice(0,20);
  saveAllHistory(all);
}
function clearAllMyHistory(){
  if(!state.playerName) return;
  const all = loadAllHistory();
  delete all[state.playerName];
  saveAllHistory(all);
  renderStageHistory();
  renderLastPlayHint();
}
function clearMyStageHistory(){
  if(!state.playerName) return;
  const all = loadAllHistory();
  ensureNameRecord(all,state.playerName);
  all[state.playerName][state.stage===1?"stage1":state.stage===2?"stage2":"stage3"] = [];
  saveAllHistory(all);
  renderHistoryThisStage();
}
function praiseByScore(score,total){
  const pct = Math.round(score*100/total);
  if(pct>=90) return {text: LANG==="th" ? "üåü ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å! ‡πÄ‡∏Å‡πà‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡πÄ‡∏ó‡∏û‡πÄ‡∏•‡∏¢!" : "üåü Amazing! You‚Äôre a superstar!", tone:"var(--ok)"};
  if(pct>=75) return {text: LANG==="th" ? "üíô ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏∞‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß!" : "üíô Great job! You‚Äôre almost there!", tone:"var(--brand)"};
  if(pct>=60) return {text: LANG==="th" ? "‚ú® ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡∏ù‡∏∂‡∏Å‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏à‡∏∞‡∏õ‡∏±‡∏á‡∏°‡∏≤‡∏Å!" : "‚ú® Nice! A bit more practice and you‚Äôll shine!", tone:"var(--accent)"};
  return {text: LANG==="th" ? "üòä ‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞‡∏à‡πä‡∏∞ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏Å‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô!" : "üòä Keep going! Try again ‚Äî you‚Äôll improve!", tone:"var(--muted)"};
}

/* =======================
   Navigation between screens
======================= */
function show(id){
  document.getElementById("screenLogin").style.display = (id==="login") ? "block" : "none";
  document.getElementById("screenStage").style.display = (id==="stage") ? "block" : "none";
  document.getElementById("screenGame").style.display  = (id==="game")  ? "block" : "none";
  document.getElementById("screenResult").style.display= (id==="result")? "block" : "none";
  state.screen = id;
  document.getElementById("progressText").textContent = "";
}
function backToLogin(){
  sClick();
  show("login");
}
function goStageSelect(){
  sClick();
  const input = document.getElementById("playerNameInput");
  const name = (input.value||"").trim();
  if(!name){
    alert(LANG==="th" ? "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞ üòä" : "Please enter a name üòä");
    input.focus(); return;
  }
  state.playerName = name;
  document.getElementById("playerBadgeName").textContent = name;
  document.getElementById("playerBadge").style.display = "inline-flex";
  show("stage");
  renderStageHistory();
}
function exitToStages(){
  sClick();
  show("stage");
  renderStageHistory();
}
function startStage(n){
  sClick();
  if(n!==1){
    alert(LANG==="th" ? "‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏à‡πâ‡∏≤ üòä" : "This stage is coming soon üòä");
    return;
  }
  state.stage = n;
  resetStageState();
  show("game");
  render();
}
function replayStage(){
  sClick();
  resetStageState();
  show("game");
  render();
}

/* =======================
   Stage gameplay
======================= */
function resetStageState(){
  state.idx = 0;
  const DATA = STAGE_DATA[state.stage] || [];
  state.picked = Array(DATA.length).fill(null);
  state.judged = Array(DATA.length).fill(null);
  state.orderMaps = Array(DATA.length).fill(null);
}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}
function showBigEmoji(isCorrect){
  const el = document.createElement("div");
  el.className = "big-emoji";
  el.textContent = isCorrect ? "üòÅüéâ" : "üòÖüí¶";
  document.body.appendChild(el);
  setTimeout(()=>el.remove(), 950);
}

function render(){
  const DATA = STAGE_DATA[state.stage] || [];
  const t = UI[LANG];
  if(!DATA.length){
    document.getElementById("question").textContent = LANG==="th" ? "‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°" : "Coming soon";
    document.getElementById("choices").innerHTML = "";
    document.getElementById("jumper").innerHTML = "";
    return;
  }
  const item = DATA[state.idx];
  document.getElementById("progressText").textContent = t.qLabel(state.idx+1, DATA.length) + " ‚Ä¢ " + (LANG==="th" ? `‡∏î‡πà‡∏≤‡∏ô ${state.stage}` : `Stage ${state.stage}`);

  document.getElementById("question").textContent = (LANG==="th") ? item.q_th : item.q_en;
  const opts = (LANG==="th") ? item.options_th : item.options_en;

  // build order map (shuffle once per question)
  if(!state.orderMaps[state.idx]){
    const base = opts.map((_,i)=>i);
    shuffle(base);
    state.orderMaps[state.idx] = base;
  }
  const order = state.orderMaps[state.idx];
  const correctScreen = order.indexOf(item.a);

  const choices = document.getElementById("choices");
  choices.innerHTML = "";
  for(let i=0;i<order.length;i++){
    const optIndex = order[i];
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = opts[optIndex];
    if(state.picked[state.idx]===i) b.classList.add("selected");
    if(state.judged[state.idx]===false){ b.disabled=true; b.classList.add("locked"); }
    if(state.judged[state.idx]!==null){
      if(i===correctScreen) b.classList.add("correct");
      if(state.picked[state.idx]===i && i!==correctScreen) b.classList.add("wrong");
    }
    b.onclick = ()=>select(i);
    choices.appendChild(b);
  }

  const jumper = document.getElementById("jumper");
  jumper.innerHTML = "";
  for(let k=0;k<DATA.length;k++){
    const d = document.createElement("button");
    d.className="dot";
    d.textContent = (k+1);
    if(k===state.idx) d.classList.add("current");
    if(state.judged[k]===true) d.classList.add("correct");
    else if(state.judged[k]===false) d.classList.add("wrong");
    else if(state.picked[k]!==null) d.classList.add("done");
    d.onclick = ()=>{ sClick(); state.idx=k; render(); };
    jumper.appendChild(d);
  }
}

function select(i){
  // Lock if answered wrong before
  if(state.judged[state.idx]===false) return;

  sClick();
  const DATA = STAGE_DATA[state.stage];
  const item = DATA[state.idx];

  const order = state.orderMaps[state.idx];
  const correctScreen = order.indexOf(item.a);

  state.picked[state.idx]=i;
  const ok = (i===correctScreen);
  state.judged[state.idx]=ok;

  showBigEmoji(ok);
  if(ok) sOk(); else sBad();
  render();
}
function prevQ(){ sClick(); if(state.idx>0){state.idx--; render();}}
function nextQ(){ sClick(); const DATA = STAGE_DATA[state.stage]; if(state.idx<DATA.length-1){state.idx++; render();}}

function finish(){
  sClick();
  const DATA = STAGE_DATA[state.stage] || [];
  let score = 0;
  for(let i=0;i<DATA.length;i++) if(state.judged[i]===true) score++;
  const pct = DATA.length ? Math.round(score*100/DATA.length) : 0;

  // Save
  if(state.playerName && DATA.length){
    addAttempt(state.playerName, state.stage, score, DATA.length);
  }

  const praise = praiseByScore(score, DATA.length||1);
  document.getElementById("playerShow").textContent = UI[LANG].playerShow(state.playerName || "-", state.stage);
  const pt = document.getElementById("praiseText");
  pt.textContent = praise.text;
  pt.style.color = praise.tone;

  document.getElementById("scoreBig").textContent = UI[LANG].score(score, DATA.length);
  document.getElementById("summary").textContent = UI[LANG].percent(pct) + " ‚Ä¢ " + (LANG==="th" ? "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: " : "Topic: ") + UI[LANG].stageName(state.stage);

  show("result");
  renderHistoryThisStage();
}

/* =======================
   History rendering
======================= */
function renderLastPlayHint(){
  const hint = document.getElementById("lastPlayHint");
  const name = (document.getElementById("playerNameInput").value||"").trim();
  if(!name){ hint.style.display="none"; return; }
  const all = loadAllHistory();
  if(!all[name]){ hint.style.display="none"; return; }
  const a1 = (all[name].stage1||[])[0];
  if(a1){
    hint.textContent = (LANG==="th")
      ? `‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏î‡πà‡∏≤‡∏ô 1): ${a1.score}/${a1.total} ‚Ä¢ ‡πÄ‡∏•‡πà‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ${(all[name].stage1||[]).length} ‡∏£‡∏≠‡∏ö`
      : `Last (Stage 1): ${a1.score}/${a1.total} ‚Ä¢ Attempts: ${(all[name].stage1||[]).length}`;
    hint.style.display="block";
  }else{
    hint.style.display="none";
  }
}
function renderStageHistory(){
  const box = document.getElementById("stageHistoryBox");
  const table = document.getElementById("stageHistoryTable");
  if(!state.playerName){ box.style.display="none"; return; }

  const all = loadAllHistory();
  if(!all[state.playerName]){ box.style.display="none"; return; }
  ensureNameRecord(all,state.playerName);

  const s1 = all[state.playerName].stage1 || [];
  const s2 = all[state.playerName].stage2 || [];
  const s3 = all[state.playerName].stage3 || [];
  const totalAttempts = s1.length + s2.length + s3.length;
  if(!totalAttempts){ box.style.display="none"; return; }

  box.style.display="block";
  const t = UI[LANG];
  const row = (arr, stageNo)=>{
    if(!arr.length) return `<tr><td>${stageNo}</td><td>${t.stageName(stageNo)}</td><td>-</td><td>-</td><td>-</td></tr>`;
    const best = arr.reduce((m,x)=> Math.max(m, Math.round(x.score*100/x.total)), 0);
    const last = arr[0];
    const lastPct = Math.round(last.score*100/last.total);
    return `<tr>
      <td><b>${stageNo}</b></td>
      <td>${t.stageName(stageNo)}</td>
      <td>${arr.length}</td>
      <td><b>${last.score}/${last.total}</b> (${lastPct}%)</td>
      <td>${best}%</td>
    </tr>`;
  };

  table.innerHTML = `
    <tr>
      <th>${LANG==="th" ? "‡∏î‡πà‡∏≤‡∏ô" : "Stage"}</th>
      <th>${LANG==="th" ? "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠" : "Topic"}</th>
      <th>${LANG==="th" ? "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö" : "Attempts"}</th>
      <th>${LANG==="th" ? "‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î" : "Last"}</th>
      <th>${LANG==="th" ? "‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î" : "Best"}</th>
    </tr>
    ${row(s1,1)}
    ${row(s2,2)}
    ${row(s3,3)}
  `;
}
function renderHistoryThisStage(){
  const box = document.getElementById("historyBox");
  const table = document.getElementById("historyTable");
  if(!state.playerName){ box.style.display="none"; return; }
  const all = loadAllHistory();
  if(!all[state.playerName]){ box.style.display="none"; return; }
  ensureNameRecord(all,state.playerName);

  const arr = getStageArr(all,state.playerName,state.stage) || [];
  if(!arr.length){ box.style.display="none"; return; }

  box.style.display="block";
  table.innerHTML = `
    <tr>
      <th>${LANG==="th" ? "‡∏£‡∏≠‡∏ö" : "No."}</th>
      <th>${LANG==="th" ? "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤" : "Date/Time"}</th>
      <th>${LANG==="th" ? "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô" : "Score"}</th>
      <th>%</th>
    </tr>
  ` + arr.map((h,i)=>{
    const pct = Math.round(h.score*100/h.total);
    return `<tr>
      <td>${i+1}</td>
      <td>${h.t}</td>
      <td><b>${h.score}/${h.total}</b></td>
      <td>${pct}%</td>
    </tr>`;
  }).join("");
}

/* =======================
   Init
======================= */
window.addEventListener("DOMContentLoaded", ()=>{
  document.getElementById("playerNameInput").addEventListener("input", renderLastPlayHint);
  document.getElementById("playerNameInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") goStageSelect(); });

  applyUI();
  setLang(LANG); // also updates buttons and re-applies UI
  show("login");
  renderLastPlayHint();
});
</script>

</body>
</html>
